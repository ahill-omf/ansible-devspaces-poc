schemaVersion: 2.2.0
metadata:
  name: ansible-devspaces-poc
variables:
  repoUrl: 'git@evdcigl-ssh.corp.fin:enterprise-engineering/ansible/collections/diagnostics.git'
  repoPath: "/projects/ansible-devspaces-poc/collections/ansible_collections/diagnostics"
components:
  - name: tooling-container
    container:
      image: quay.io/devspaces/ansible-creator-ee@sha256:3128cce4c1f2c1600db7750ad8b1b0cc655fb59c621d982c863c24696c4bd68c
      memoryRequest: 256M
      memoryLimit: 6Gi
      cpuRequest: 250m
      cpuLimit: 2000m
      args: ['tail', '-f', '/dev/null']
      env:
        - name: 'ANSIBLE_COLLECTIONS_PATH'
          value: '~/.ansible/collections:/usr/share/ansible/collections:/projects/ansible-devspaces-poc/collections'
        - name: "COLLECTION_URL"
          value: "{{repoUrl}}"
        - name: "COLLECTION_PATH"
          value: "{{repoPath}}"
commands:
  - id: find-yaml
    exec:
      label: '### CHILD ONLY ### List yaml within projects'
      commandLine: 'find . -name "\*.y*ml"'
      workingDir: /projects
      component: tooling-container
  - id: bootstrap
    exec:
      label: '### CHILD ONLY ### Bootstrap'
      commandLine: 'echo "hello world" > bootstrap.txt'
      workingDir: /projects
      component: tooling-container
events:
  postStart:
    - "bootstrap"